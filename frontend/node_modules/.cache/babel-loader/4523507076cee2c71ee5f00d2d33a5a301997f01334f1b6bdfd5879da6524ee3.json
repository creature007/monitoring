{"ast":null,"code":"import { ref, onMounted } from 'vue';\nimport axios from 'axios';\nimport moment from 'moment';\nexport default {\n  name: 'Reports',\n  setup() {\n    const period = ref('weekly');\n    const report = ref(null);\n    const fetchReport = async () => {\n      try {\n        const response = await axios.get('http://127.0.0.1:8007/api/report', {\n          params: {\n            type: period.value\n          }\n        });\n        report.value = response.data.report;\n      } catch (error) {\n        console.error('Hisobot olishda xatolik:', error);\n      }\n    };\n    const setPeriod = async newPeriod => {\n      period.value = newPeriod;\n      await fetchReport();\n    };\n    const formatDate = timestamp => {\n      if (!timestamp) return 'Mavjud emas';\n      return moment(timestamp).format('YYYY-MM-DD HH:mm:ss');\n    };\n    const downloadReport = () => {\n      if (!report.value) return;\n      const data = report.value.devices.map(device => ({\n        'Qurilma raqami': device.number,\n        'Tavsif': device.description || '',\n        'Holat': device.status_period === 'active' ? 'Faol' : 'Nofaol',\n        'Oxirgi faollik': formatDate(device.lastupdate)\n      }));\n      const csvContent = \"data:text/csv;charset=utf-8,\" + Object.keys(data[0]).join(\",\") + \"\\n\" + data.map(row => Object.values(row).join(\",\")).join(\"\\n\");\n      const encodedUri = encodeURI(csvContent);\n      const link = document.createElement(\"a\");\n      link.setAttribute(\"href\", encodedUri);\n      link.setAttribute(\"download\", `hisobot_${period.value}_${moment().format('YYYY-MM-DD')}.csv`);\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    };\n    onMounted(() => {\n      fetchReport();\n    });\n    return {\n      period,\n      report,\n      setPeriod,\n      formatDate,\n      downloadReport\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","axios","moment","name","setup","period","report","fetchReport","response","get","params","type","value","data","error","console","setPeriod","newPeriod","formatDate","timestamp","format","downloadReport","devices","map","device","number","description","status_period","lastupdate","csvContent","Object","keys","join","row","values","encodedUri","encodeURI","link","document","createElement","setAttribute","body","appendChild","click","removeChild"],"sources":["C:\\Users\\user\\Desktop\\dastur\\hp\\monitoring\\frontend\\src\\views\\Reports.vue"],"sourcesContent":["<template>\r\n  <div class=\"reports\">\r\n    <h1>Hisobotlar</h1>\r\n\r\n    <div class=\"report-controls\">\r\n      <div class=\"period-selector\">\r\n        <Button \r\n          :class=\"{ active: period === 'weekly' }\" \r\n          @click=\"setPeriod('weekly')\"\r\n          label=\"Haftalik\"\r\n          icon=\"pi pi-calendar\"\r\n        />\r\n        <Button \r\n          :class=\"{ active: period === 'monthly' }\" \r\n          @click=\"setPeriod('monthly')\"\r\n          label=\"Oylik\"\r\n          icon=\"pi pi-calendar-times\"\r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"report-content\" v-if=\"report\">\r\n      <!-- Umumiy ma'lumotlar -->\r\n      <div class=\"report-summary\">\r\n        <Card class=\"summary-card\">\r\n          <template #title>\r\n            <div class=\"card-title\">\r\n              <i class=\"pi pi-calendar\"></i>\r\n              {{ report.period }}\r\n            </div>\r\n          </template>\r\n          <template #content>\r\n            <div class=\"summary-stats\">\r\n              <div class=\"summary-item\">\r\n                <label>Jami qurilmalar</label>\r\n                <span class=\"total\">{{ report.total_devices }}</span>\r\n              </div>\r\n              <div class=\"summary-item\">\r\n                <label>Faol qurilmalar</label>\r\n                <span class=\"active\">{{ report.active_devices }}</span>\r\n              </div>\r\n              <div class=\"summary-item\">\r\n                <label>Nofaol qurilmalar</label>\r\n                <span class=\"inactive\">{{ report.inactive_devices }}</span>\r\n              </div>\r\n            </div>\r\n          </template>\r\n        </Card>\r\n      </div>\r\n\r\n      <!-- Qurilmalar ro'yxati -->\r\n      <Card class=\"devices-table\">\r\n        <template #title>\r\n          <div class=\"table-header\">\r\n            <div class=\"card-title\">\r\n              <i class=\"pi pi-list\"></i>\r\n              Qurilmalar ro'yxati\r\n            </div>\r\n            <Button icon=\"pi pi-download\" label=\"Yuklash\" @click=\"downloadReport\" />\r\n          </div>\r\n        </template>\r\n        <template #content>\r\n          <DataTable \r\n            :value=\"report.devices\" \r\n            :paginator=\"true\" \r\n            :rows=\"10\"\r\n            responsiveLayout=\"scroll\"\r\n            class=\"p-datatable-sm\"\r\n            sortField=\"lastupdate\"\r\n            :sortOrder=\"-1\"\r\n          >\r\n            <Column field=\"number\" header=\"Qurilma raqami\" sortable>\r\n              <template #body=\"slotProps\">\r\n                <router-link :to=\"'/device/' + slotProps.data.id\" class=\"device-link\">\r\n                  {{ slotProps.data.number }}\r\n                </router-link>\r\n              </template>\r\n            </Column>\r\n            <Column field=\"description\" header=\"Tavsif\" sortable />\r\n            <Column field=\"status_period\" header=\"Davr holati\" sortable>\r\n              <template #body=\"slotProps\">\r\n                <span :class=\"['status-badge', slotProps.data.status_period]\">\r\n                  {{ slotProps.data.status_period === 'active' ? 'Faol' : 'Nofaol' }}\r\n                </span>\r\n              </template>\r\n            </Column>\r\n            <Column field=\"lastupdate\" header=\"Oxirgi faollik\" sortable>\r\n              <template #body=\"slotProps\">\r\n                {{ formatDate(slotProps.data.lastupdate) }}\r\n              </template>\r\n            </Column>\r\n          </DataTable>\r\n        </template>\r\n      </Card>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted } from 'vue'\r\nimport axios from 'axios'\r\nimport moment from 'moment'\r\n\r\nexport default {\r\n  name: 'Reports',\r\n  setup() {\r\n    const period = ref('weekly')\r\n    const report = ref(null)\r\n\r\n    const fetchReport = async () => {\r\n      try {\r\n        const response = await axios.get('http://127.0.0.1:8007/api/report', {\r\n          params: { type: period.value }\r\n        })\r\n        report.value = response.data.report\r\n      } catch (error) {\r\n        console.error('Hisobot olishda xatolik:', error)\r\n      }\r\n    }\r\n\r\n    const setPeriod = async (newPeriod) => {\r\n      period.value = newPeriod\r\n      await fetchReport()\r\n    }\r\n\r\n    const formatDate = (timestamp) => {\r\n      if (!timestamp) return 'Mavjud emas'\r\n      return moment(timestamp).format('YYYY-MM-DD HH:mm:ss')\r\n    }\r\n\r\n    const downloadReport = () => {\r\n      if (!report.value) return\r\n\r\n      const data = report.value.devices.map(device => ({\r\n        'Qurilma raqami': device.number,\r\n        'Tavsif': device.description || '',\r\n        'Holat': device.status_period === 'active' ? 'Faol' : 'Nofaol',\r\n        'Oxirgi faollik': formatDate(device.lastupdate)\r\n      }))\r\n\r\n      const csvContent = \"data:text/csv;charset=utf-8,\" + \r\n        Object.keys(data[0]).join(\",\") + \"\\n\" +\r\n        data.map(row => Object.values(row).join(\",\")).join(\"\\n\")\r\n\r\n      const encodedUri = encodeURI(csvContent)\r\n      const link = document.createElement(\"a\")\r\n      link.setAttribute(\"href\", encodedUri)\r\n      link.setAttribute(\"download\", `hisobot_${period.value}_${moment().format('YYYY-MM-DD')}.csv`)\r\n      document.body.appendChild(link)\r\n      link.click()\r\n      document.body.removeChild(link)\r\n    }\r\n\r\n    onMounted(() => {\r\n      fetchReport()\r\n    })\r\n\r\n    return {\r\n      period,\r\n      report,\r\n      setPeriod,\r\n      formatDate,\r\n      downloadReport\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.reports {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 2rem;\r\n}\r\n\r\n.report-controls {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.period-selector {\r\n  display: flex;\r\n  gap: 1rem;\r\n}\r\n\r\n.period-selector .p-button {\r\n  transition: all 0.3s;\r\n}\r\n\r\n.period-selector .p-button.active {\r\n  background: #2196F3;\r\n  border-color: #2196F3;\r\n}\r\n\r\n.report-summary {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\r\n  gap: 1.5rem;\r\n}\r\n\r\n.card-title {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  font-size: 1.1rem;\r\n  color: #666;\r\n}\r\n\r\n.summary-stats {\r\n  display: grid;\r\n  grid-template-columns: repeat(3, 1fr);\r\n  gap: 1rem;\r\n}\r\n\r\n.summary-item {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  text-align: center;\r\n}\r\n\r\n.summary-item label {\r\n  font-size: 0.875rem;\r\n  color: #666;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n.summary-item span {\r\n  font-size: 1.5rem;\r\n  font-weight: bold;\r\n}\r\n\r\n.summary-item span.total {\r\n  color: #2196F3;\r\n}\r\n\r\n.summary-item span.active {\r\n  color: #4caf50;\r\n}\r\n\r\n.summary-item span.inactive {\r\n  color: #f44336;\r\n}\r\n\r\n.table-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.device-link {\r\n  color: #2196F3;\r\n  text-decoration: none;\r\n  font-weight: 500;\r\n}\r\n\r\n.device-link:hover {\r\n  text-decoration: underline;\r\n}\r\n\r\n.status-badge {\r\n  padding: 0.25rem 0.75rem;\r\n  border-radius: 1rem;\r\n  font-size: 0.875rem;\r\n  font-weight: 500;\r\n}\r\n\r\n.status-badge.active {\r\n  background: #e8f5e9;\r\n  color: #4caf50;\r\n}\r\n\r\n.status-badge.inactive {\r\n  background: #ffebee;\r\n  color: #f44336;\r\n}\r\n</style>\r\n"],"mappings":"AAmGA,SAASA,GAAG,EAAEC,SAAQ,QAAS,KAAI;AACnC,OAAOC,KAAI,MAAO,OAAM;AACxB,OAAOC,MAAK,MAAO,QAAO;AAE1B,eAAe;EACbC,IAAI,EAAE,SAAS;EACfC,KAAKA,CAAA,EAAG;IACN,MAAMC,MAAK,GAAIN,GAAG,CAAC,QAAQ;IAC3B,MAAMO,MAAK,GAAIP,GAAG,CAAC,IAAI;IAEvB,MAAMQ,WAAU,GAAI,MAAAA,CAAA,KAAY;MAC9B,IAAI;QACF,MAAMC,QAAO,GAAI,MAAMP,KAAK,CAACQ,GAAG,CAAC,kCAAkC,EAAE;UACnEC,MAAM,EAAE;YAAEC,IAAI,EAAEN,MAAM,CAACO;UAAM;QAC/B,CAAC;QACDN,MAAM,CAACM,KAAI,GAAIJ,QAAQ,CAACK,IAAI,CAACP,MAAK;MACpC,EAAE,OAAOQ,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK;MACjD;IACF;IAEA,MAAME,SAAQ,GAAI,MAAOC,SAAS,IAAK;MACrCZ,MAAM,CAACO,KAAI,GAAIK,SAAQ;MACvB,MAAMV,WAAW,CAAC;IACpB;IAEA,MAAMW,UAAS,GAAKC,SAAS,IAAK;MAChC,IAAI,CAACA,SAAS,EAAE,OAAO,aAAY;MACnC,OAAOjB,MAAM,CAACiB,SAAS,CAAC,CAACC,MAAM,CAAC,qBAAqB;IACvD;IAEA,MAAMC,cAAa,GAAIA,CAAA,KAAM;MAC3B,IAAI,CAACf,MAAM,CAACM,KAAK,EAAE;MAEnB,MAAMC,IAAG,GAAIP,MAAM,CAACM,KAAK,CAACU,OAAO,CAACC,GAAG,CAACC,MAAK,KAAM;QAC/C,gBAAgB,EAAEA,MAAM,CAACC,MAAM;QAC/B,QAAQ,EAAED,MAAM,CAACE,WAAU,IAAK,EAAE;QAClC,OAAO,EAAEF,MAAM,CAACG,aAAY,KAAM,QAAO,GAAI,MAAK,GAAI,QAAQ;QAC9D,gBAAgB,EAAET,UAAU,CAACM,MAAM,CAACI,UAAU;MAChD,CAAC,CAAC;MAEF,MAAMC,UAAS,GAAI,8BAA6B,GAC9CC,MAAM,CAACC,IAAI,CAAClB,IAAI,CAAC,CAAC,CAAC,CAAC,CAACmB,IAAI,CAAC,GAAG,IAAI,IAAG,GACpCnB,IAAI,CAACU,GAAG,CAACU,GAAE,IAAKH,MAAM,CAACI,MAAM,CAACD,GAAG,CAAC,CAACD,IAAI,CAAC,GAAG,CAAC,CAAC,CAACA,IAAI,CAAC,IAAI;MAEzD,MAAMG,UAAS,GAAIC,SAAS,CAACP,UAAU;MACvC,MAAMQ,IAAG,GAAIC,QAAQ,CAACC,aAAa,CAAC,GAAG;MACvCF,IAAI,CAACG,YAAY,CAAC,MAAM,EAAEL,UAAU;MACpCE,IAAI,CAACG,YAAY,CAAC,UAAU,EAAE,WAAWnC,MAAM,CAACO,KAAK,IAAIV,MAAM,CAAC,CAAC,CAACkB,MAAM,CAAC,YAAY,CAAC,MAAM;MAC5FkB,QAAQ,CAACG,IAAI,CAACC,WAAW,CAACL,IAAI;MAC9BA,IAAI,CAACM,KAAK,CAAC;MACXL,QAAQ,CAACG,IAAI,CAACG,WAAW,CAACP,IAAI;IAChC;IAEArC,SAAS,CAAC,MAAM;MACdO,WAAW,CAAC;IACd,CAAC;IAED,OAAO;MACLF,MAAM;MACNC,MAAM;MACNU,SAAS;MACTE,UAAU;MACVG;IACF;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}